* bookmarklet
** Hate '続きを読む'
   #+BEGIN_SRC js
     javascript:(function(){($("a:contains(続きを読む)")[0] || $("a:contains(このページをスキップする)")[0] || $("a:contains(つづきを読む)")[0]).click();})()
   #+END_SRC
** load js(jquery)
*** only load
    #+BEGIN_SRC js
      javascript:(function(){
          // <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
          var s = document.createElement('script');
          s.src = "//ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js";
          document.head.appendChild(s);
      })()
    #+END_SRC
*** load and script
    #+BEGIN_SRC js
      javascript:(function(){
          // <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
          var s = document.createElement('script');
          document.head.appendChild(s);
          s.onload = function(){
              console.log('loaded');
          };
          s.src = "//ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js";
      })()

    #+END_SRC
*** loader
    #+BEGIN_SRC js
      javascript:(function(){
          var loadScript = function(src, cb){
              var s = document.createElement('script');
              document.head.appendChild(s);
              s.onload = cb;
              s.src = src;
          };
          var loadStyle = function(src, cb){
              var s = document.createElement('link');
              document.head.appendChild(s);
              s.onload = cb;
              s.href = src;
              s.rel = 'stylesheet';
          };
      })()
    #+END_SRC
*** load webpacked js hosted by =npm run dev=
    #+BEGIN_SRC js
      var loadScript = function(src, cb){
        var s = document.createElement('script');
        document.head.appendChild(s);
        s.onload = cb;
        s.src = src;
      };
      loadScript('http://localhost:8080/app.js')
    #+END_SRC
** send page to slack with incoming webhook
   currently this supports only Qiita articles.
    #+BEGIN_SRC js
      javascript:(function(){
          var hook_url = 'https://hooks.slack.com/services/AAABBBBBCCCC';

          var send2slack = function(hook){
              var icon = $('link[rel="shortcut icon"]') && $('link[rel="shortcut icon"]').attr('href');
              var fetch_og = function(key){
                  return $('meta[property="' + key + '"]') && $('meta[property="' + key + '"]').attr('content');
              };
              var site_name = fetch_og('og:site_name');
              var title = fetch_og('og:title');
              title = title || document.title;
              var title_link = fetch_og('og:url');
              title_link = title_link || window.location.href;
              var text=fetch_og('og:description');
              text = text && text.replace('&',' ').replace('<',' ').replace('>',' ');
              var image_url = fetch_og('og:image');
              var ts = $('time[itemprop=datePublished]') && new Date($('time[itemprop=datePublished]').attr('datetime')).getTime();

              var payload = {
                  attachments: [
                      {
                          "fallback": "URL sharing.",
                          "color": "#36a64f",
                          "pretext": title,
                          "author_name": site_name,
                          "author_icon": icon,
                          "title": title,
                          "title_link": title_link,
                          "text": text,
                          "image_url": image_url,
                          "footer": site_name,
                          "footer_icon": icon,
                          "ts": ts
                      }
                  ]
              };

              $.ajax({
                  type: 'POST',
                  url: hook,
                  data: 'payload=' + JSON.stringify(payload),
                  success: function (data) {
                      window.close();
                  }
              });
          };

          var s = document.createElement('script');
          document.head.appendChild(s);
          s.onload = function(){send2slack(hook_url);};
          s.src = "//ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js";
      })()
    #+END_SRC
** copy to clipboard
   inspired by http://stackoverflow.com/a/31596687/514411 (remove jQuery dependency)
   #+BEGIN_SRC js
     javascript:(function(){
         var copy = function(copyText, successCB){
             if(!successCB){
                 successCB = function(){
                     alert("The text is on the clipboard, try to paste it!");
                 };
             }
             var success = true;
             var range = document.createRange();
             var selection;

             // For IE.
             if(window.clipboardData){
                 window.clipboardData.setData("Text", copyText);
                 return;
             }
             // Create a temporary element off screen.
             var tmpElem = document.createElement('div');
             tmpElem.style.position = 'absolute';
             tmpElem.style.left = '-1000px';
             tmpElem.style.top = '-1000px';
             tmpElem.innerText = copyText;
             document.body.appendChild(tmpElem);

             // Select temp element.
             range.selectNodeContents(tmpElem);
             selection = window.getSelection();
             selection.removeAllRanges();
             selection.addRange (range);

             // Lets copy.
             try{
                 success = document.execCommand("copy", false, null);
             }catch(e){
                 copyToClipboardFF(copyText);
             }
             if(success){
                 successCB();
                 tmpElem.remove();
             }
         };
         copy('some text you want');
     })()
   #+END_SRC
** copy link as markdown
   copy format: =[document.title](location.href)=
   #+BEGIN_SRC js
     javascript:(function(){
         var copy = function(copyText, successCB){
             if(!successCB){
                 successCB = function(text){
                     alert("The text is on the clipboard, try to paste it!\nCopied:\n\n" + text);
                 };
             }
             if(window.clipboardData){
                 window.clipboardData.setData("Text", copyText);
                 return;
             }
             var tmpElem=document.createElement('div');
             tmpElem.style.position = 'absolute';
             tmpElem.style.left = '-1000px';
             tmpElem.style.top = '-1000px';
             tmpElem.innerText = copyText;
             document.body.appendChild(tmpElem);

             var range = document.createRange();
             range.selectNodeContents(tmpElem);

             var selection;
             selection = window.getSelection();
             selection.removeAllRanges();
             selection.addRange(range);

             var success = true;
             try{
                 success = document.execCommand("copy", false, null);
             }
             catch(e){
                 copyToClipboardFF(copyText);
             }
             if(success){
                 successCB(copyText);
                 tmpElem.remove();
             }
         };
         copy('['+document.title+']('+location.href+')');
     })()
   #+END_SRC

** copy link as org-mode
   copy format: =[[location.href][document.title]]=
   #+BEGIN_SRC js
     javascript:(function(){
         var copy = function(copyText, successCB){
             if(!successCB){
                 successCB = function(text){
                     alert("The text is on the clipboard, try to paste it!\nCopied:\n\n" + text);
                 };
             }
             if(window.clipboardData){
                 window.clipboardData.setData("Text", copyText);
                 return;
             }
             var tmpElem=document.createElement('div');
             tmpElem.style.position = 'absolute';
             tmpElem.style.left = '-1000px';
             tmpElem.style.top = '-1000px';
             tmpElem.innerText = copyText;
             document.body.appendChild(tmpElem);

             var range = document.createRange();
             range.selectNodeContents(tmpElem);

             var selection;
             selection = window.getSelection();
             selection.removeAllRanges();
             selection.addRange(range);

             var success = true;
             try{
                 success = document.execCommand("copy", false, null);
             }
             catch(e){
                 copyToClipboardFF(copyText);
             }
             if(success){
                 successCB(copyText);
                 tmpElem.remove();
             }
         };
         copy('[['+location.href+']['+document.title+']]');
     })()
   #+END_SRC

** copy feed url with =/feed subscribe=
   #+BEGIN_SRC js
     javascript:(function(){
         var copy = function(copyText, successCB){
             if(!successCB){
                 successCB = function(text){
                     alert("The text is on the clipboard, try to paste it!\nCopied:\n\n" + text);
                 };
             }
             if(window.clipboardData){
                 window.clipboardData.setData("Text", copyText);
                 return;
             }
             var tmpElem=document.createElement('div');
             tmpElem.style.position = 'absolute';
             tmpElem.style.left = '-1000px';
             tmpElem.style.top = '-1000px';
             tmpElem.innerText = copyText;
             document.body.appendChild(tmpElem);

             var range = document.createRange();
             range.selectNodeContents(tmpElem);

             var selection;
             selection = window.getSelection();
             selection.removeAllRanges();
             selection.addRange(range);

             var success = true;
             try{
                 success = document.execCommand("copy", false, null);
             }
             catch(e){
                 copyToClipboardFF(copyText);
             }
             if(success){
                 successCB(copyText);
                 tmpElem.remove();
             }
         };

         document.querySelectorAll('link').forEach(function(e,i,a){
             if(e.rel!='alternate'){
                 return;
             }
             console.log({e: e.rel, type: e.type, url: e.href});
             copy('/feed subscribe ' + e.href);
         });

     })()
   #+END_SRC
** cookpad find recommend
   #+BEGIN_SRC js
     (function(){
         var pickupTopRecipe = function(){
             var top = $('li a.recommend_premium_above_search_result').first().clone();
             $(top).css('position', 'fixed');
             $(top).css('top', '0');
             $(top).css('left', '0');
             $(top).css('z-index', '100');
             $(top).css('float', 'left');
             $('body').append(top);
         };

         var hideNoise = function(){
             $('.ext_ad_category_hijack').remove();
             $('.ps_suggestions').remove();
             $('.card_ui_infeed_ad').remove();
             $('.packaged_ps_lead_wrapper').remove();
             $('.ad').remove();
             $('.pro_recipes_wrapper').remove();
             $('.separated').remove();
             $('.dish_suggestions').remove();
             $('.fixed_ad').remove();
             $('.card_content').remove();
             $('.myfolder_button_container').remove();
             $('.card_content').remove();
             $('.video_label_wrapper').remove();
         };

         var gridImages = function(){
             $('.card_image').css('display', 'inline');
             $('#recipes a img').css('width', '86px');
             $('#recipes a').insertBefore('#recipes');
             $('#recipes').children().remove();
         };

         // http://stackoverflow.com/a/8486188/514411
         var getJsonFromUrl = function(search) {
             var query = search.substr(1);
             var result = {};
             query.split("&").forEach(function(part) {
                 var item = part.split("=");
                 result[item[0]] = decodeURIComponent(item[1]);
             });
             return result;
         };
         var serialize = function(obj) {
             var str = [];
             for(var p in obj)
                 if (obj.hasOwnProperty(p)) {
                     str.push(encodeURIComponent(p) + "=" + encodeURIComponent(obj[p]));
                 }
             return str.join("&");
         };

         var incrementPageNo = function(){
             var next = getJsonFromUrl($('a[rel=next]')[0].search);
             var currentPage = +next.page - 1;
             // update Text
             var pageText = $('a[rel=next]').prev().text();
             var nextPageText = pageText.replace(new RegExp(currentPage + '/'), next.page + '/');
             $('a[rel=next]').prev().text(nextPageText);
             // update href
             next.page = +next.page + 1;
             $('a[rel=next]')[0].search = '?' + serialize(next);
         };

         var loadNextPage = function(e){
             e.preventDefault();
             $.ajax({
                 url: $('a[rel=next]').attr('href'),
                 success: function(data, status, jqXHR){console.log(data.response);},
                 error: function(jqXHR, status, error){console.log(error);}
             }).done(function( html ) {
                 // $('#recipes a img', html).css('width', '86px');
                 $('<div id="next"></div>').appendTo('body');
                 $(html).appendTo('#next');
                 $('#next .item_content').remove();
                 $('#next .recipe_image').css('display', 'inline');
                 $('#next a.recipe_link').insertBefore('#recipes');
                 // $('#next').children().remove();
                 // $(html).insertBefore('.paginate');
                 incrementPageNo();
                 // $('<h3>test</h3>').insertBefore('.paginate');
             });
         };
         $('a[rel=next]').click(loadNextPage);

         var loadJQ = function(cb){
             var s = document.createElement('script');
             document.head.appendChild(s);
             s.onload = cb;
             s.src = "//ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js";
         };

         var main = function(){
             pickupTopRecipe();
             hideNoise();
             gridImages();
             loadJQ(function(){});
         };
         main();
     })();

   #+END_SRC
** send to google keep
   #+BEGIN_SRC js2
     javascript:void(function(){
         var w = 430;
         var h = 600;
         var t = (screen.height ? (screen.height - h) / 4 : 0);
         var l = (screen.width ? (screen.width - w) / 2 : 0);
         var win = window.open('https://drive.google.com/keep/','google-keep','width='+w+',height='+h+',top='+t+',left='+l+',location=no,personalbar=no,menubar=no,status=no,resizable=yes,scrollbars=yes');
     })();
   #+END_SRC
** add console
   #+BEGIN_SRC js2
     javascript:(function(){
         var old = document.getElementById('console');
         if(old){
             old.parentElement.removeChild(old);
             window.console = window._console;
         }
         var setStyle = function(){
             var s = document.createElement('style');
             s.innerHTML = ''
                 + '    /* The console container element */'
                 + '    #console {'
                 + '      position: absolute;'
                 + '      width: 660px;'
                 + '      height: 480px;'
                 + '      background-color:black;'
                 + '    }'
                 + '    /* The inner console element. */'
                 + '    .jqconsole {'
                 + '        padding: 10px;'
                 + '    }'
                 + '    /* The cursor. */'
                 + '    .jqconsole-cursor {'
                 + '        background-color: gray;'
                 + '    }'
                 + '    /* The cursor color when the console looses focus. */'
                 + '    .jqconsole-blurred .jqconsole-cursor {'
                 + '        background-color: #666;'
                 + '    }'
                 + '    /* The current prompt text color */'
                 + '    .jqconsole-prompt {'
                 + '        color: #0d0;'
                 + '    }'
                 + '    /* The command history */'
                 + '    .jqconsole-old-prompt {'
                 + '        color: #0b0;'
                 + '        font-weight: normal;'
                 + '    }'
                 + '    /* The text color when in input mode. */'
                 + '    .jqconsole-input {'
                 + '        color: #dd0;'
                 + '    }'
                 + '    /* Previously entered input. */'
                 + '    .jqconsole-old-input {'
                 + '        color: #bb0;'
                 + '        font-weight: normal;'
                 + '    }'
                 + '    /* The text color of the output. */'
                 + '    .jqconsole-output {'
                 + '        color: white;'
                 + '    }'
                 + '    /* The text color of the output. */'
                 + '    .jqconsole-warning {'
                 + '        color: yellow;'
                 + '    }'
                 + '    /* The text color of the output. */'
                 + '    .jqconsole-error {'
                 + '        color: red;'
                 + '    }'
                 + '    /* The text color of the output. */'
                 + '    .jqconsole-info {'
                 + '        color: blue;'
                 + '    }'
                 + '    /* The text color of the output. */'
                 + '    .jqconsole-return {'
                 + '        color: gray;'
                 + '    }';
             document.head.appendChild(s);
         };
         setStyle();

         var loadScript = function(src, cb){
             var s = document.createElement('script');
             document.head.appendChild(s);
             s.onload = cb;
             s.src = src;
         };
         var loadStyle = function(src, cb){
             var s = document.createElement('link');
             document.head.appendChild(s);
             s.onload = cb;
             s.href = src;
             s.rel = 'stylesheet';
         };

         var initConsole = function(){
             var d = document.createElement('div');
             d.id = 'console';
             document.body.appendChild(d);
             $('#console').draggable();
             $('#console').resizable();
             var jqconsole = $('#console').jqconsole('', '');

             window._console = window.console;
             var writeString = {
                 log(string){
                     jqconsole.Write(string + '\n', 'jqconsole-output');
                     window._console.log(string);
                 },
                 warn(string){
                     jqconsole.Write(string + '\n', 'jqconsole-warning');
                     window._console.warn(string);
                 },
                 error(string){
                     jqconsole.Write(string + '\n', 'jqconsole-error');
                     window._console.error(string);
                 },
                 info(string){
                     jqconsole.Write(string + '\n', 'jqconsole-info');
                     window._console.info(string);
                 },
                 isJqConsole: true
             };
             if(!window.console.isJqConsole){
                 window.console = writeString;
             }

             jqconsole.RegisterShortcut('A', function() {
                 jqconsole.MoveToStart();
             });
             jqconsole.RegisterShortcut('E', function() {
                 jqconsole.MoveToEnd();
             });
             var startPrompt = function(){
                 jqconsole.RegisterMatching('(', ')', 'parents');
                 var prompt = '> ';
                 jqconsole.Write(prompt, 'jqconsole-prompt');
                 var processInput = function(input){
                     try{
                         var result = eval(input);
                         jqconsole.Write(result + '\n', 'jqconsole-return');
                     }catch(err){
                         console.log(err);
                         jqconsole.Write('ERROR: ' + err.message + '\n', 'jqconsole-error');
                     }
                     startPrompt();
                 };
                 jqconsole.Prompt(true, processInput);
             };
             startPrompt();
         };

         var jquiCss = '//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css';
         var jq = '//jscl-project.github.io/jquery.js';
         var jqui = '//code.jquery.com/ui/1.12.1/jquery-ui.js';
         var jqconsole = '//jscl-project.github.io/jqconsole.min.js';
         loadStyle(jquiCss, function(){
             loadScript(jq, function(){
                 loadScript(jqui, function(){
                     loadScript(jqconsole, function(){
                         initConsole();
                     });
                 });
             });
         });
     })();

   #+END_SRC
** shorten amazon url with affiliate tag
   #+BEGIN_SRC js
     javascript:(function(){
       // cf: http://www.takewari.com/amazon_url_shortener.html
       var getAsin = function(target){
         if( target.match( /(http:\/\/[^\/]*\/).*product-description\/([^\/|\?]*)/i)) return [ RegExp.$1, RegExp.$2];
         if( target.match( /(http:\/\/[^\/]*\/).*dp\/([^\/|\?]*)/i)) return [ RegExp.$1, RegExp.$2];
         if( target.match( /(http:\/\/[^\/]*\/).*product\/([^\/|\?]*)/i)) return [ RegExp.$1, RegExp.$2];
         if( target.match( /(http:\/\/[^\/]*\/).*-\/([^\/|\?]*)/)) return [ RegExp.$1, RegExp.$2];
         if( target.match( /(http:\/\/[^\/]*\/).*ISBN=([^\/|\?]*)/i)) return [ RegExp.$1, RegExp.$2];
         if( target.match( /(http:\/\/[^\/]*\/).*ASIN\/([^\/|\?]*)/i)) return [ RegExp.$1, RegExp.$2];
         if( target.match( /(www[^\/]*\/).*product-description\/([^\/|\?]*)/i)) return [ RegExp.$1, RegExp.$2];
         if( target.match( /(www[^\/]*\/).*dp\/([^\/|\?]*)/i)) return [ RegExp.$1, RegExp.$2];
         if( target.match( /(www[^\/]*\/).*product\/([^\/|\?]*)/i)) return [ RegExp.$1, RegExp.$2];
         if( target.match( /(www[^\/]*\/).*-\/([^\/|\?]*)/)) return [ RegExp.$1, RegExp.$2];
         if( target.match( /(www[^\/]*\/).*ISBN=([^\/|\?]*)/i)) return [ RegExp.$1, RegExp.$2];
         if( target.match( /(www[^\/]*\/).*ASIN\/([^\/|\?]*)/i)) return [ RegExp.$1, RegExp.$2];
       };

       var getShortUrl = function(url){
         var asin = getAsin(url);
         if(!asin || asin.length === 0){
           return url;
         }
         var short = asin[0] + 'dp/' + asin[1];
         return short;
       };

       var copy = function(copyText, successCB){
         if(!successCB){
           successCB = function(text){
             alert("The text is on the clipboard, try to paste it!\nCopied:\n\n" + text);
           };
         }
         if(window.clipboardData){
           window.clipboardData.setData("Text", copyText);
           return;
         }
         var tmpElem=document.createElement('div');
         tmpElem.style.position = 'absolute';
         tmpElem.style.left = '-1000px';
         tmpElem.style.top = '-1000px';
         tmpElem.innerText = copyText;
         document.body.appendChild(tmpElem);

         var range = document.createRange();
         range.selectNodeContents(tmpElem);

         var selection;
         selection = window.getSelection();
         selection.removeAllRanges();
         selection.addRange(range);

         var success = true;
         try{
           success = document.execCommand("copy", false, null);
         }
         catch(e){
           copyToClipboardFF(copyText);
         }
         if(success){
           successCB(copyText);
           tmpElem.remove();
         }
       };

       copy(getShortUrl(location.href) + '/?tag=peccu-22');
     })()
   #+END_SRC
